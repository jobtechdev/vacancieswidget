/* ========================================
 * jquery-easy.menu.js v1.0.0
 * 2013-04-11
 * (c) Kristoffer Lundberg (CGI)
 * ======================================== */
(function ($) {

    var pluginName = 'easyMenu';
    var pluginOptions = {
        openSpeed: 0,
        openCssClass: 'open',
        hideDelay: 500,
        showDelay: 150
    };

    var plugin = function (elem, opts) {
        this.element = $(elem);
        this.options = $.extend(pluginOptions, opts || {});
        this.bind();
    }

    plugin.prototype = {
        bind: function () {
            var _this = this;
            var element = this.element;
            var options = this.options;

            element.removeClass('no-js');
            element.addClass(pluginName);
            element.children('li').each(function () {
                var el = $(this);
                
                el.hover(function (e) {
                    e.stopPropagation();

                    clearTimeout(el.showTimeout);
                    clearTimeout(el.hideTimeout);
                    el.showTimeout = setTimeout(function () {
                        _this.show(el);
                    }, options.showDelay);

                }, function (e) {
                    clearTimeout(el.showTimeout);
                    clearTimeout(el.hideTimeout);
                    el.hideTimeout = setTimeout(function () {
                        _this.hide(el);
                    }, options.hideDelay);
                });
            });

            element.find('a').focus(function () {
                _this.show($(this).closest('li'));
            });
        },

        show: function (elem) {
            var _this = this;
            var element = this.element;
            var options = this.options;

            if (elem.find('ul').length != 0)
                elem.addClass(options.openCssClass);
            elem.siblings('li').each(function () {
                _this.hide($(this));
            });   
        },

        hide: function (elem) {
            var element = this.element;
            var options = this.options;

            elem.removeClass(options.openCssClass);
        }
    }

    $.fn[pluginName] = function (opts) {
        return this.each(function () {
            new plugin(this, opts);
        });
    }

})(jQuery);